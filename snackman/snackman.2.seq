;*************************;*                       *;* CALCULATE SCREEN ADDR *;*                       *;*************************GETSCR STY TEMP1 STA TEMP2 STX TEMP3 TYA ASL A TAY STY TEMP4 LDY TEMP1 LDA MSBS,Y STA MSB2 LDA #4 STA SCREEN+1 LDY TEMP4 LDA XPOS+22 AND #1 BEQ NOADDL DEC TEMP3NOADDL LDA XPOS,Y CLC ADC TEMP3 PHP LSR A LSR A LSR A PLP BCC NOHI CLC ADC #$20NOHI STA SCREEN LDA MSB AND MSB2 BEQ OK LDA SCREEN CLC ADC #$20 STA SCREEN BCC OK INC SCREEN+1OK LDA YPOS,Y CLC ADC TEMP2 LSR A LSR A LSR A BEQ OUT TAY LDA SCREENLOOP2 CLC ADC #$28 BCC NEXT INC SCREEN+1NEXT DEY BNE LOOP2 STA SCREENOUT LDA SCREEN SEC SBC #$F3 STA SCREEN BCS OUT1 DEC SCREEN+1OUT1 LDY TEMP1 RTSMSBS .BYTE $01,$02,$04,$08 .BYTE $10,$20,$40,$80;****************;*              *;* GET MOVEMENT *;*              *;****************GETDIR LDA JOY AND #15 CMP #15 BNE GETJOY LDX #1 LDA 203 ; GET KEYBOARD INPUT - TGFH CMP #$16 ; UP BEQ OKKJOY INX CMP #$1A ; DOWN BEQ OKKJOY INX CMP #$15; LEFT BEQ OKKJOY INX CMP #$1D ; RIGHT BEQ OKKJOY LDA #0 STA FLAG LDX DIR RTSGETJOY LDX #0NEXT2 INX LSR A BCS NEXT2OKKJOY LDA #1 STA FLAG CPX #0 RTS;*******************;*                 *;* CHECK DIRECTION *;*                 *;*******************CHECK STX TEMP5 LDA XDIR,X TAX LDY TEMP5 LDA YDIR,Y LDY #0 JSR GETSCR LDA (SCREEN),Y CMP #$20 BEQ IGNORE CMP #$1D BEQ IGNORE CMP #$9D BEQ IGNORE CMP #$60 BEQ IGNORE CMP #$6C BEQ DOT CMP #$7B BEQ DOT2 CMP #$1B BEQ PILL CMP #$9B BEQ PILL CMP #27 BCC IGNORE LDX #0 RTSIGNORE LDX TEMP5EXIT1 RTSRID LDA #$20 LDY #0 STA (SCREEN),Y INY STA (SCREEN),Y RTS;***********;*         *;* EAT DOT *;*         *;***********DOT LDX TEMP5 CPX #4 BEQ IGNOREDOT3 JSR RID LDX #DIGITS LDY #1 JSR POINTS JSR SOUND1 LDA #16 LDX TEMP5 CPX #$03 BCS LEFRIT LDA #8LEFRIT STA HITDOT DEC DOTS RTSDOT2 LDX TEMP5 CPX #4 BNE EXIT1 LDX SCREEN BNE NOLO DEC SCREEN+1NOLO DEX STX SCREEN JMP DOT3;******************;*                *;* EAT POWER PILL *;*                *;******************PILL JSR RID LDX #DIGITS LDY #5 JSR POINTS DEC DOTSCHEAT2 LDA #1 STA GPOINT LDX #4LOOP17 LDA MODE,X CMP #0 BEQ CHANGE CMP #1 BNE NCHANGCHANGE LDA #1 STA MODE,X LDA #15 STA XPOS+39,XNCHANG DEX BNE LOOP17 LDA #1 JSR TURN LDA PTIME STA PTIMER LDA PTIME+1 STA PTIMER+1 LDA SFLAG ORA #1 STA SFLAG LDX TEMP5 RTSXDIR .BYTE $00,$05,$05,$04,$15YDIR .BYTE $00,$04,$0D,$05,$05;***************************;*                         *;* MAKE GHOSTS TURN AROUND *;*                         *;***************************TURN STA TEMP1 LDX #4LOOP19 LDA MODE,X CMP TEMP1 BNE NTURN LDA GDIR,X TAY LDA OPPDIR,Y STA GDIR,X LDA #10 SEC SBC EVERY8,X STA EVERY8,XNTURN DEX BNE LOOP19 RTS;*********************;*                   *;* DOT SOUND ROUTINE *;*                   *;*********************SOUND1 LDA #0 STA SOUND+4 LDX #7LOOP3 LDA DATA1,X STA SOUND,X DEX BNE LOOP3 RTSDATA1 .BYTE $00,$20,$00,$00 .BYTE $51,$61,$00;********************;*                  *;* CALCULATE POINTS *;*                  *;********************POINTS LDA ANI BNE AD2368 STX TEMP1 STX TEMP2LOOP7 LDX TEMP1LOOP8 LDA #1 STA $D806,X CPX #DIGITS-3 BNE INN LDA SCORE,X AND #1 BEQ INN INC MEN LDA #0 STA TEMP2 LDX #DIGITS-3INN LDA SCORE,X CLC ADC #1 CMP #$3A BNE NOTEQ LDA #$30 STA SCORE,XNEX DEX BNE LOOP8 BEQ PRINT2NOTEQ STA SCORE,XNEX2 DEY BNE LOOP7PRINT2 LDA TEMP2 BNE PRINT JMP TOPPRINT LDX #DIGITSLOOP9 LDA SCORE,X STA $0406,X DEX BNE LOOP9AD2368 RTS;***********************;*                     *;* CHECK OPPOSITE SIDE *;*     OF PACMAN       *;*                     *;***********************CHECK2 STX TEMP5 LDA XDIR2,X TAX LDY TEMP5 LDA YDIR2,Y LDY #0 JSR GETSCR LDA (SCREEN),Y LDX #$07LOOP10 CMP DATA3,X BEQ IGNOR2 DEX BPL LOOP10 CMP #27 BCC IGNOR2 LDX #0 RTSIGNOR2 LDX TEMP5 RTSXDIR2 .BYTE $00,$14,$14,$04,$15YDIR2 .BYTE $00,$04,$0D,$0C,$0CDATA3 .BYTE $20,$1B,$1D,$9B,$9D .BYTE $6C,$7B,$60;************************;*                      *;* MAKE PAC MAN "CHOMP" *;*                      *;************************CHOMP DEC TIMER1 BNE EXIT LDA #2 STA TIMER1 LDY POS INY TYA AND #7 STA TEMP1 TXA ASL A ASL A ASL A ORA TEMP1 CLC ADC #152 STA POSEXIT RTS;************************;*                      *;* CHECK FOR OFF SCREEN *;*     IN SPRITE .Y     *;*                      *;************************EDGE TYA ASL A TAX LDA YPOS,X CMP #$37 BCC SPOFF CMP #$E8 BCS SPOFF LDA MSBS,Y AND MSB BEQ CHLESS LDA XPOS,X CMP #$40 BCS SPOFF LDA #1 RTSSPOFF LDA #0 RTSCHLESS LDA XPOS,X CMP #$15 BCC SPOFF LDA #1 RTS;******************;*                *;* MOVE SPRITE UP *;*                *;******************UP STY TEMP1 TYA ASL A TAY STY TEMP2 LDA YPOS,Y TAY DEY CPY #1 BCS OFF AND #7 CLC ADC #$EF TAYOFF TYA LDY TEMP2 STA YPOS,Y LDY TEMP1 RTS;********************;*                  *;* MOVE SPRITE DOWN *;*                  *;********************DOWN STY TEMP1 TYA ASL A TAY STY TEMP2 LDA YPOS,Y TAY INY CPY #$F0 BCC OFF2 AND #7 CLC ADC #1 TAYOFF2 TYA LDY TEMP2 STA YPOS,Y RTS;********************;*                  *;* MOVE SPRITE LEFT *;*                  *;********************LEFT STY TEMP1 TYA ASL A TAY STY TEMP2 LDY TEMP1 LDA MSBS,Y STA MSB2 LDY TEMP2 LDA XPOS,Y BEQ OVER TAY DEY LDA MSB AND MSB2 PHP TYA PLP BNE EXIT2 CPY #4 BCC OVEREXIT2 LDY TEMP2 STA XPOS,Y LDY TEMP1 RTSOVER LDA MSB EOR MSB2 STA MSB AND MSB2 BEQ MOST LDY TEMP2 LDA XPOS,Y AND #7 CLC ADC #$77 BNE EXIT2MOST LDA #$FF BNE EXIT2;*********************;*                   *;* MOVE SPRITE RIGHT *;*                   *;*********************RIGHT STY TEMP1 TYA ASL A TAY STY TEMP2 LDY TEMP1 LDA MSBS,Y STA MSB2 LDA MSB AND MSB2 BEQ LESS LDY TEMP2 LDA XPOS,Y TAY INY CPY #$75 BCS OFF3NEQ TYA LDY TEMP2 STA XPOS,Y LDY TEMP1 RTSOFF3 LDY TEMP2 LDA XPOS,Y AND #7 CLC ADC #1OFF4 LDY TEMP2 STA XPOS,Y LDA MSB EOR MSB2 STA MSB LDY TEMP1 RTSLESS LDY TEMP2 LDA XPOS,Y TAY INY BNE NEQ LDA #0 BEQ OFF4;****************;*              *;* MOVE PAC MAN *;*              *;****************MOVE CPX #0 BEQ MOVE4 CPX #1 BNE MOVE1 JMP UPMOVE1 CPX #2 BNE MOVE2 JMP DOWNMOVE2 CPX #3 BNE MOVE3 JMP LEFTMOVE3 CPX #4 BNE MOVE4 JMP RIGHTMOVE4 RTS;*********************;*                   *;* MAIN JUMP ROUTINE *;*                   *;*********************PACMAN DEC TIMER2 BNE OUT4 LDA #11 DEC HITDOT BEQ NODOT LDA #16 STA TIMER2 LDA HITDOT CMP #8 BNE GO JSR SOUND1 JMP GONODOT STA TIMER2 LDA #1 STA HITDOTGO LDY #0 JSR EDGE BEQ EDGE2 JSR GETDIR BEQ OUT2STICK JSR CHECK2 BEQ OUT2 JSR CHECK BEQ OUT2EDGE3 STX DIR JSR CHOMP LDY #0 JMP MOVEOUT2 LDA FLAG BNE OUT3 LDA #160 STA POS STX DIROUT4 RTSOUT3 LDX DIR LDA #0 STA FLAG JMP STICKEDGE2 JSR GETDIR CPX DIR BEQ EDGE3 LDA OPPDIR,X CMP DIR BEQ EDGE3 LDX DIR JMP EDGE3;***********************;*                     *;* GET GHOST DIRECTION *;*                     *;***********************GSTDIR LDA GDIR,Y TAX LDA OPPDIR,X TAX STA LOOK,X LDA MODE,Y BEQ MODE1 JMP MODE2MODE1 JSR RNDNUM CMP SKILL BCS TOWAR1RNDDIR JSR RNDNUM AND #3 TAX INX LDA LOOK,X BNE RNDDIR LDA #1 STA FLAG STA LOOK,X RTSTOWAR1 JSR TOWARD LDA LOOK,X BNE OPAXIS LDA #12 STA FLAG STA LOOK,X RTSOPAXIS LDA AXIS BEQ XAXIS3 JSR YAXIS JMP TIGERXAXIS3 JSR XAXISTIGER LDA LOOK,X BNE RNDDIR LDA #1 STA FLAG STA LOOK,X RTSTOWARD JSR RNDNUM AND #1 STA AXIS BNE XAXISYAXIS LDY TEMP7 TYA ASL A TAY LDA YPOS CMP YPOS,Y BEQ XAXIS1 BCS GREAT LDX #1 RTSGREAT LDX #2 RTSXAXIS LDY TEMP7 TYA ASL A TAYXAXIS1 STY TEMP1 LDY TEMP7 LDA MSBS,Y STA MSB2 LDA MSB AND #1 BEQ LESS2 LDA MSB AND MSB2 BEQ PGREATXCMP LDY TEMP1 LDA XPOS CMP XPOS,Y BEQ YAXIS BCC GGREATPGREAT LDX #4 RTSGGREAT LDX #3 RTSLESS2 LDA MSB AND MSB2 BEQ XCMP BNE GGREATOPPDIR .BYTE $00,$02,$01,$04,$03;*************************;*                       *;* MODE FOR GHOST ESCAPE *;*                       *;*************************MODE2 CMP #1 BNE MODE3 JSR TOWARD LDA OPPDIR,X LDX TEMP7 ASL TIMER3,X TAX LDA #1 STA FLAG LDA LOOK,X BNE RNDJMP RTSRNDJMP JMP RNDDIR;*****************;*               *;* RESTORE GHOST *;*               *;*****************MODE3 CMP #2 BNE MODE4 JSR TOWAR2 BEQ GOAT LDY TEMP7 LDA #0 STA HOUSE,Y LDA TIMER3,Y LSR A STA TIMER3,Y LDA LOOK,X BNE OPPAX LDA #11 STA FLAG STA LOOK,XMODE4 RTSGOAT LDY TEMP7 LDA #0 STA MODE,Y LDA #1 STA HOUSE,Y LDA GRAPIC,Y STA POS,Y LDA COLOUR,Y STA XPOS+39,Y LDX #3 RTSOPPAX LDY TEMP7 TYA ASL A TAY LDA AXIS BEQ YAXIS2 JSR XAXIS2 JMP STUPIDYAXIS2 JSR YAXIS1STUPID LDA LOOK,X BNE RNDJMP LDA #1 STA FLAG STA LOOK,X RTSTOWAR2 LDY TEMP7 TYA ASL A TAY LDA YPOS,Y CMP HOUSEY BNE GOTO LDA XPOS,Y CMP HOUSEX BNE GOTO9 RTSGOTO9 SEC SBC #1 CMP HOUSEX BNE GOTO RTSGOTO JSR RNDNUM AND #1 STA AXIS BEQ XAXIS2YAXIS1 LDA HOUSEY CMP YPOS,Y BEQ XAXIS2 BCS GREAT1 LDX #1 RTSGREAT1 LDX #2 RTSXAXIS2 STY TEMP1 LDY TEMP7 LDA MSBS,Y STA MSB2 LDA MSB AND MSB2 BNE GGREA1XCMP1 LDY TEMP1 LDA HOUSEX CLC ADC #1 CMP XPOS,Y BEQ YAXIS1 LDA HOUSEX CMP XPOS,Y BEQ YAXIS1 BCC GGREA1 LDX #4 RTSGGREA1 LDX #3 RTS;*******************************;*                             *;* CHECK IF HE IS IN THE HOUSE *;*                             *;*******************************IHOUSE LDA HOUSE,Y BEQ OUT8QQQQQ LDY #4 LDA #0LOOP26 STA LOOK,Y DEY BNE LOOP26 LDA #10 STA FLAG STA LOOK+2 LDX TEMP7 CPX #1 BEQ SHURE DEC OUTHO,X BNE OUT9 LDA #1 STA OUTHO,XSHURE LDX #1 TXA STA LOOK,X LDY TEMP7 RTSOUT9 LDY TEMP7 LDA GDIR,Y TAX STA LOOK,XOUT8 RTS;*******************************;*                             *;* CHECK DIRECTION FOR GHOST Y *;*                             *;*******************************CHECK3 STX TEMP5 STY TEMP6 LDA XDIR,X TAX LDY TEMP5 LDA YDIR,Y LDY TEMP6 JSR GETSCR LDY #0 LDA (SCREEN),Y LDX #0LOOP11 CMP DATA4,X BEQ OUT5 INX CPX #8 BNE LOOP11 CMP #$60 BEQ SLOW CMP #0 BNE KILL LDY TEMP6 LDA HOUSE,Y BNE OUT5 LDA #1 STA HOUSE,Y JSR QQQQQ JMP OUT5KILL CMP #26 BCC OUT5 LDY TEMP6 LDX #0 RTSSLOW LDY TEMP6 LDA MODE,Y BNE OUT5 LDA SPEED,Y ASL A STA TIMER3,Y LDX TEMP5 RTSOUT5 LDY TEMP6 LDX TEMP5 RTSDATA4 .BYTE $20,$1B,$1D,$9B,$9D .BYTE $6C,$7B,$44;*****************************;*                           *;* CHECK OTHER SIDE OF GHOST *;*                           *;*****************************CHECK4 LDA XDIR2,X TAX LDY TEMP5 LDA YDIR2,Y LDY TEMP6 JSR GETSCR LDY #0 LDA (SCREEN),Y LDX #8 LDY TEMP6LOOP12 CMP DATA5,X BEQ IGNOR3 DEX BPL LOOP12 CMP #$44 BEQ PIG CMP #27 BCC IGNOR3KILL2 LDX #0 RTSIGNOR3 LDX TEMP5OUT7 RTSPIG LDY TEMP6 LDA MODE,Y CMP #2 BEQ IGNOR3 LDX TEMP5 CPX #1 BNE KILL2 LDA TIMER3,Y ASL A ASL A STA TIMER3,Y LDA #0 STA HOUSE,Y LDX TEMP5 RTSDATA5 .BYTE $20,$1B,$1D,$9B,$9D .BYTE $6C,$7B,$60,$00;**********************;*                    *;* MAIN GHOST ROUTINE *;*                    *;**********************GHOST LDY #4LOOP13 STY TEMP7 SEI JSR GHOST2 CLI LDY TEMP7 DEY BNE LOOP13 INC PTIMER BNE EXIT3 INC PTIMER+1 BEQ NPOWEREXIT3 RTSNPOWER LDA SFLAG AND #254 STA SFLAG LDY #4LOOP18 LDA MODE,Y CMP #1 BNE DOG LDA #0 STA MODE,Y LDA COLOUR,Y STA XPOS+39,YDOG DEY BNE LOOP18 RTS;*****************************;*                           *;* MOVE SINGLE GHOST GIVEN Y *;*                           *;*****************************GHOST2 LDA MODE,Y CMP #1 BNE NFLASH LDA SFLAG ORA #1 STA SFLAG LDA PTIMER+1 CMP #$F6 BCC NFLASH AND #1 BNE NFLASH LDA PTIMER BNE NFLASH LDA XPOS+39,Y EOR #3 STA XPOS+39,YNFLASH TYA TAX DEC TIMER3,X BNE OUT6 LDA SPEED,X STA TIMER3,X TYA TAX DEC EVERY8,X BEQ GHOST3EVERY9 LDA TSPEED,Y STA TIMER3,Y LDA GDIR,Y TAX JMP MOVEGHOST3 LDA #8 STA EVERY8,X LDY TEMP7 JSR EDGE BEQ EDGE4 LDX #4 LDA #0LOOP14 STA LOOK,X DEX BNE LOOP14 JSR GSTDIR LDY TEMP7 JSR IHOUSECHECK5 JSR CHECK3 BEQ HIT JSR CHECK4 BEQ HIT TXA STA GDIR,Y LDA TIMER3,Y STA TSPEED,Y JMP MOVEHIT LDA FLAG CMP #10 BEQ INHOSE CMP #11 BEQ HOME CMP #12 BEQ JOHNHORSE JSR RNDDIR JMP CHECK5OUT6 RTSINHOSE LDY TEMP7 LDA GDIR,Y TAX STA LOOK,X LDA #1 STA FLAG JMP CHECK5HOME JSR OPPAX LDY TEMP7 JMP CHECK5JOHN JSR OPAXIS LDY TEMP7 JMP CHECK5EDGE4 LDY TEMP7 LDA MODE,Y TAX LDA MODASL,X STA INSTR LDA GDIR,Y TAX LDA TIMER3,YINSTR NOP STA TSPEED,Y JMP MOVEMODASL ASL A ASL A LSR A .FILE SNACKMAN.3