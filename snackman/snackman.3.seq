;************************;*                      *;* CHECK IF PACMAN DIES *;*   OR GHOST DIES      *;*                      *;************************DEATH LDA XPOS+30 STA TEMP6 AND #1 BNE CHCH STA XPOS+30 RTSCHCH LDA #0 STA XPOS+30 LDY #1 LDA #2 STA MSB2LOOP28 STY TEMP7 TYA ASL A STA TEMP5 LDA TEMP6 AND MSB2 BEQ NEXT4 CPY #5 BCS ASDFG LDA MODE,Y CMP #2 BEQ NEXT4ASDFG JSR YDEATH BNE NEXT4 JSR XDEATH BEQ DIENEXT4 ASL MSB2 LDY TEMP7 INY CPY #7 BNE LOOP28 RTS;***************;*             *;* CHECK FOR Y *;*  DIRECTION  *;*    DEATH    *;*             *;***************YDEATH LDY TEMP5 LDA YPOS,Y SEC SBC YPOS CMP #251 BCS YES CMP #4 BCC YES LDA #1 RTSYES LDA #0 RTSDIE LDY TEMP7 CPY #5 BCC MODES JSR EAT JMP NEXT4MODES LDA MODE,Y BNE PDEATH PLA PLA LDA #>PDIE PHA LDA #<PDIE PHA JMP NEXT4PDEATH CMP #1 BEQ GDEATH BNE NEXT4;*************;*           *;* EAT GHOST *;*           *;*************GDEATH ASL GPOINT LDA #0 STA SOUND+18 LDA SFLAG ORA #3 STA SFLAG LDA #200 STA STEMP2 LDA #5 STA STEMP3 LDA XPOS+21 AND #$FE STA XPOS+21 LDY TEMP7 LDA #1 STA XPOS+39,Y CPY #4 BNE QWEQTY LDA #40 STA OUTHO,YQWEQTY LDY GPOINT LDX #DIGITS-1 JSR POINTS LDA GPOINT LDX #199LOOP29 INX LSR A BCC LOOP29 TXA LDY TEMP7 STA POS,Y LDX #0LOOP31 LDY #2 STY TEMP1 LDY #50LOOP32 DEY BNE LOOP32 DEC TEMP1 BNE LOOP32 STX SOUND+8 INX BNE LOOP31 LDA #200 LDY TEMP7 STA POS,Y LDA #2 STA MODE,Y LDA XPOS+21 ORA #1 STA XPOS+21 JMP NEXT4;***************;*             *;* CHECK FOR X *;*  DIRECTION  *;*    DEATH    *;*             *;***************XDEATH LDA MSB AND #1 BEQ PALESS LDA MSB AND MSB2 BNE EQMINUS LDA XPOS,Y BMI EQ LDA XPOS BPL NOEQ LDA XPOS SEC SBC XPOS,Y CMP #6 BCC YES1 CMP #249 BCS YES1NO LDA #1 RTSYES1 LDA #0 RTSPALESS LDA MSB AND MSB2 BEQ EQ BNE MINUS;*******************;*                 *;* MAKE PACMAN DIE *;*                 *;*******************PDIE BRK JSR SHUTUP LDA #160 STA POS LDY #0 LDA #5 LDX #0 JSR WAIT LDA #1 STA XPOS+21 LDY #0 LDX #0 JSR WAIT LDX #6LOOP38 LDA DATA7,X STA SOUND,X DEX BPL LOOP38 LDX #200LOOP40 LDY #3 STY TEMP1 LDY #200LOOP39 DEY BNE LOOP39 DEC TEMP1 BNE LOOP39 STX SOUND+1 TXA AND #15 CMP #15 BNE NODIE LDY POS CPY #163 BEQ EXTRA INY STY POS JMP NODIEEXTRA LDY #209 STY POSNODIE DEX CPX #8 BNE LOOP40 LDA #2 STA TEMP1GOAL LDX #0LOOP42 LDY #90LOOP41 DEY BNE LOOP41 STX SOUND+1 INX BNE LOOP42 DEC TEMP1 BNE GOAL LDA #20 STA SOUND+4 LDA #0 STA XPOS+21 LDX MEN DEX CPX #255 BEQ ENDGAM STX MEN JSR RESET JMP NEWENDGAM JSR GAMOVR LDA #11 LDX #0 LDY #0 JSR WAIT CLI JMP GAMOVGAMOVR LDA #0 LDY #4 STA SCREEN STY SCREEN+1 LDY #40TGBNHY LDA (SCREEN),Y BEQ PRRINT INY BNE TGBNHY INC SCREEN+1 LDA SCREEN+1 CMP #8 BCC TGBNHY RTSPRRINT TYA SEC SBC #81 STA SCREEN LDA SCREEN+1 SBC #0 STA SCREEN+1 CLC ADC #$D4 STA SCREEN+3 LDA SCREEN STA SCREEN+2 LDY #9QAZXSW LDA DATA12,Y STA (SCREEN),Y LDA #1 STA (SCREEN+2),Y DEY BPL QAZXSW RTSDATA12 .BYTE $07,$81,$8D,$85 .BYTE $20,$20,$0F,$96 .BYTE $85,$92DATA7 .BYTE $00,$00,$00,$00 .BYTE $11,$30,$F0,$00;**************;*            *;* RESET GAME *;*            *;**************RESET PHP SEI LDX #32LOOP35 LDA SET2+10,X STA TIMER3,X DEX BPL LOOP35 LDA #3 STA DIR STA TIMER2 LDA #1 STA TIMER1 STA HITDOT LDA #0 STA SFLAG LDA BON4 LDY BON4+1 CPY BON3+1 BNE OK11 CMP BON3OK11 BCS SHOOT LDA BON3 LDY BON3+1SHOOT CPY #3 BCS OK111 LDA #0 LDY #2OK111 STA BON3 STY BON3+1 LDA #0 STA XPOS+30 STA BMODE LDX #2 LDY #3 LDA #10LOOP57 CLC ADC #15 STA OUTHO,X INX DEY BNE LOOP57 PLP JMP REPOS;********;*      *;* WAIT *;*      *;********WAIT DEY BNE WAIT DEX BNE WAIT SEC SBC #1 BNE WAIT RTS;*****************;*               *;* SOUND ROUTINE *;*               *;*****************SOUNDS LDA SFLAG AND #4 BEQ SONN LDA BTEMP1 BNE BBBBB LDX BTEMP2 DEX CPX #20 BEQ EEOR STX BTEMP2 STX SOUND+15 JMP SONNEEOR LDA #1 STA BTEMP1 JMP SONNBBBBB LDX BTEMP2 INX CPX #110 BEQ ENED STX BTEMP2 STX SOUND+15 JMP SONNENED LDA #0 STA SOUND+18 LDA SFLAG AND #251 STA SFLAGSONN LDA SFLAG BNE YOUOU JMP RUNINGYOUOU AND #2 BEQ KKKKK LDX STEMP2 DEX STX STEMP2 STX SOUND+8 CPX #10 BNE CURENT LDX #200 STX STEMP2 DEC STEMP3 BNE CURENT LDA SFLAG AND #253 STA SFLAG LDA #100 STA STEMP2CURENT RTSKKKKK LDA SFLAG AND #1 BEQ RUNING LDX #4JJJJJ LDA MODE,X CMP #1 BEQ LLLLL DEX BNE JJJJJ LDA SFLAG AND #254 STA SFLAG RTSLLLLL LDA STEMP3 BEQ SUBTAC LDA STEMP2 CLC ADC #10 STA STEMP2 STA SOUND+8 BCC LION LDA #255 STA STEMP2 STA SOUND+8 LDA #0 STA STEMP3LION RTSSUBTAC LDA STEMP2 SEC SBC #10 STA STEMP2 STA SOUND+8 BCS LION2 LDA #0 STA STEMP2 STA SOUND+8 LDA #1 STA STEMP3LION2 RTSRUNING DEC TIMER5 BNE LION2 LDA #2 STA TIMER5 LDA STEMP3 BEQ SUBTA2 LDA STEMP2 CLC ADC #1 CMP #150 BCS KJKF STA STEMP2 STA SOUND+8 RTSKJKF STA STEMP2 STA SOUND+8 LDA #0 STA STEMP3 RTSSUBTA2 LDA STEMP2 SEC SBC #1 CMP #50 STA STEMP2 STA SOUND+8 BCS LION4 LDA #1 STA STEMP3LION4 RTS;******************;*                *;* SET UP VOICE 2 *;*                *;******************VOICE2 LDA #0 STA SOUND+11 LDX #6LOOP30 LDA DATA6,X STA SOUND+7,X DEX BNE LOOP30 RTSDATA6 .BYTE $00,$10,$00,$00 .BYTE $11,$10,$A0;**************************;*                        *;* MAKE POWER PILLS FLASH *;*                        *;**************************PILLS DEC TIMER4 BNE LION4 LDA #16 STA TIMER4 LDX NUMBERLOOP4 LDA (ASPRIN,X) AND #$7F CMP #$1B BEQ FLASH2 CMP #$1D BEQ FLASH2NRE DEX DEX BNE LOOP4 RTSFLASH2 LDA (ASPRIN,X) EOR #$80 STA (ASPRIN,X) JMP NRE;*********;*       *;* BONUS *;*       *;*********RRRRTS RTSBONUS LDA BON1 BEQ RRRRTS DEC BONSPD BNE RRRRTS LDA #24 STA BONSPD LDA BMODE BNE NOTON5 JMP NOTONNOTON5 CMP #3 BNE YURYU JMP GOOFFYURYU LDA XPOS+22 AND #1 STA TEMP1 LDA XPOS+12 SEC SBC TEMP1 AND #7 CMP #3 BEQ YURYU1KIILL LDX BONDIR JMP OKOKOKYURYU1 LDA YPOS+12 AND #7 CMP #3 BNE KIILL LDX #4 LDA #0LOOP46 STA LOOK,X DEX BNE LOOP46 LDX BONDIR BEQ RNDJMM LDA OPPDIR,X TAX STA LOOK,X LDY #6 JSR EDGE BEQ NCHCK JSR BONGETCHCK JSR BONCK1 BEQ RNDJMM JSR BONCK2 BEQ RNDJMMCHCK2 LDA YPOS+12 CMP #$26 BCC GONE CMP #$F1 BCS GONE LDA MSB AND #64 BEQ OKLESS LDA XPOS+12 CMP #81 BCS GONE BCC OKOKOKOKLESS LDA XPOS+12 CMP #3 BCC GONEOKOKOK STX BONDIR LDY #5 JSR MOVE LDX BONDIR LDY #6 JSR MOVE LDX BONDIR LDY #7 JMP CHOMP0RRTS RTSNCHCK LDX BONDIR JMP CHCK2RNDJMM JSR RNDDIR JMP CHCKNOTON DEC BON3 BNE RRTS DEC BON3+1 BNE RRTS JSR REPOS LDA XPOS+21 ORA BON2 STA XPOS+21 LDA #1 STA BMODE LDA BON5 LDY BON5+1 STA BON3 STY BON3+1 JMP YURYUGOOFF DEC BON3 BNE RRTSGONE LDA #31 STA XPOS+21 LDX BONDIR LDA OPPDIR,X STA BONDIR LDA BON4 LDY BON4+1 STA BON3 STY BON3+1 DEC BON1 LDA #0 STA BMODE RTS;******************;*                *;* POSITION BONUS *;*                *;******************REPOS LDA XPOS+21 AND #31 STA XPOS+21 JSR RNDNUM AND $0225 CMP $0226 BCS REPOS ASL A TAX LDA BONUSC,X BEQ XBON LDY #0 AND #2 BEQ NOMSB LDY #224NOMSB STY TEMP1 LDA MSB AND #$1F ORA TEMP1 STA MSB LDA #2 STA BONDIR JSR RNDNUM LDY #$27 AND #1 BEQ Y2 LDY #$F0 LDA #1 STA BONDIRY2 LDA BONUSL,X JMP SHOVEXBON JSR RNDNUM LDY #0 AND #1 BEQ NOMSB2 LDY #224NOMSB2 STY TEMP1 LDA MSB AND #$1F ORA TEMP1 STA MSB LDA #4 STA BONDIR LDA #4 PHA LDA MSB LDY #$30 AND #224 BEQ X2 PLA LDA #80 PHA LDA #3 STA BONDIRX2 LDA BONUSL,X TAY PLASHOVE PHA LDA XPOS+22 AND #1 BEQ SHOVE2 PLA CLC ADC #1 PHASHOVE2 PLA STA XPOS+10 STA XPOS+12 STA XPOS+14 STY YPOS+10 STY YPOS+12 STY YPOS+14 LDA BON9 BPL NMIOOAGD JSR RNDNUM AND #15 CMP #7 BCS OOAGD ORA #128 STA BON9 AND #15STAY TAX LDA BON10,X STA BON2 LDA YPON,X STA BON6 LDA XPON,X STA BON7 LDA GRPON,X STA BON8 LDA LEN,X TAX LDY #0REGRAB LDA BON11,X STA GRAPIC+5,Y STA POS+5,Y LDA BON12,X STA COLOUR+5,Y STA XPOS+44,Y INX INY CPY #3 BNE REGRAB RTSNMI LDA GRAPIC+6 STA POS+6 LDA COLOUR+6 STA XPOS+45 RTS;***********;*         *;* BONUSES *;*         *;***********LEN .BYTE $00,$03,$06,$09 .BYTE $0C,$0F,$12,$15BON10 .BYTE $C0,$C0,$C0,$40 .BYTE $E0,$C0,$40BON11 .BYTE $00,$DA,$DB .BYTE $00,$DC,$DD .BYTE $00,$DE,$DF .BYTE $00,$E0,$00 .BYTE $E3,$E1,$E2 .BYTE $00,$E4,$E5 .BYTE $00,$A0,$00BON12 .BYTE $00,$0A,$0D .BYTE $00,$01,$07 .BYTE $00,$0A,$0D .BYTE $00,$0D,$00 .BYTE $0A,$0D,$01 .BYTE $00,$0D,$0F .BYTE $00,$07,$00XPON .BYTE $02,$04,$08,$01 .BYTE $02,$05,$07YPON .BYTE $05,$05,$05,$04 .BYTE $04,$04,$04GRPON .BYTE $C9,$CA,$CB,$CD .BYTE $CE,$CF,$D0;****************************;*                          *;* MAKE BONUS PAC MAN CHOMP *;*                          *;****************************CHOMP0 LDA POS+6 CMP #192 BCS ONMOVE CLC ADC #1 AND #7 STA TEMP1 TXA ASL A ASL A ASL A CLC ADC TEMP1 ADC #152 STA POS+6ONMOVE JMP MOVE;***********************;*                     *;* GET BONUS DIRECTION *;*                     *;***********************BONGET LDA BMODE CMP #1 BNE CHARGE DEC BON3 BNE MMOVE DEC BON3+1 BNE MMOVE LDA #2 STA BMODE LDY #6 STY TEMP7MMOVE JSR TOWAR2 LDA LOOK,X BNE RNDJPP LDA #1 STA LOOK,X RTSCHARGE JSR TOWAR2 LDA OPPDIR,X TAX LDA LOOK,X BNE RNDJPP LDA #1 STA LOOK,X RTSRNDJPP JMP RNDDIR;*************************;*                       *;* CHECK BONUS DIRECTION *;*                       *;*************************BONCK1 STX TEMP6 LDA XDIR,X TAX LDY TEMP6 LDA YDIR,YCKCH LDY #6 JSR GETSCR LDY #0 LDX TEMP6 LDA (SCREEN),Y LDY #7LOOP51 CMP DATA13,Y BEQ OKOK DEY BPL LOOP51 CMP #27 BCC OKOK LDA #0 RTSOKOK LDA #1 RTSDATA13 .BYTE $20,$60,$1B,$1D .BYTE $9D,$9B,$6C,$7B;*****************************;*                           *;* CHECK OTHER SIDE OF BONUS *;*                           *;*****************************BONCK2 STX TEMP6 LDA XDIR2,X TAX LDY TEMP6 LDA YDIR2,Y JMP CKCH;*************;*           *;* EAT BONUS *;*           *;*************EAT LDA XPOS+21 AND #64 BEQ RRRTS LDA POS+6 CMP BON8 BEQ RRRTS LDA #3 STA BMODE LDA SFLAG ORA #4 STA SFLAG LDA #0 STA BTEMP1 LDA #200 STA BTEMP2 LDX #6LOOP48 LDA DATA11,X STA SOUND+14,X DEX BPL LOOP48 LDX BON6 LDY BON7 JSR POINTS LDA BON8 STA POS+6 LDA #1 STA XPOS+45 LDA #95 STA XPOS+21 LDA #100 LDY #1 STA BON3 STY BON3+1RRRTS RTSDATA11 .BYTE $00,$CB,$00,$00 .BYTE $21,$60,$F0,$00 .FILE SNACKMAN.4