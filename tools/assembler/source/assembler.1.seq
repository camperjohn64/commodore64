;*********************************;**                             **;**     COMMODORE ASSEMBLER     **;**                             **;** COPYRIGHT 1978 BY COMMODORE **;**      BUSINESS MACHINES      **;**                             **;** UNASSEMBLED,  COMMENTED AND **;** MODIFIED  BY  JOHN MCCARTHY **;**     ON SEPTEMBER 8, 1984    **;**                             **;** PART 1                      **;**                             **;*********************************; SKIP1=$24 ; SKIP ONE BYTE BIT COMMAND SKIP2=$2C ; SKIP TWO BYTES BIT COMMAND JUMP=$4C ; 6510 JMP COMMAND; VID=$10 ; VIDEO DISPLAY BIT; Z00=$00 Z02=$02 Z03=$03 Z04=$04 Z05=$05 PC=$06 ; PROCESSER ADDRESS Z08=$08 Z09=$09 Z0A=$0A Z0B=$0B Z0C=$0C Z0D=$0D Z0E=$0E Z0F=$0F Z10=$10 Z11=$11 Z12=$12 Z13=$13 Z14=$14 Z15=$15 Z16=$16 Z17=$17 Z18=$18 Z19=$19 Z1A=$1A Z1B=$1B Z1C=$1C Z1D=$1D Z1E=$1E Z1F=$1F ST=$90 ; DISK STATUS BYTE ZA9=$A9 ZB7=$B7 FILPNT=$BB KEYLEN=$C6 VICHIP=$D011 ZE386=$E386 TOSCRN=$E716 SETMSG=$FF90 SETLFS=$FFBA SETNAM=$FFBD OPEN=$FFC0 ZFFC1=$FFC1 CLOSE=$FFC3 CHKIN=$FFC6 CHKOUT=$FFC9 CLRCHN=$FFCC INPUT=$FFCF CHROUT=$FFD2 TSTSTP=$FFE1 GETCHR=$FFE4; *=$0801; .WORD ZEROS .BYTE <10,>10,158,"(2063)",0ZEROS .WORD 0; JSR Z287A LDA #%10000000 JSR SETMSG JMP DOASM;Z081A *=*+19Z082D *=*+1Z082E *=*+1Z082F *=*+1Z0830 *=*+1Z0831 *=*+1Z0832 *=*+1Z0833 *=*+5CRSREF *=*+1 ; CROSS REFERANCE FLAGOUTFIL *=*+1 ; CURRENT CHKOUT FILESRCNAM *=*+16 ; SOURCE NAMESRCLEN *=*+1 ; SOURCE NAME LENGTHZ084B *=*+1Z084C *=*+1Z084D *=*+2Z084F *=*+1Z0850 *=*+1Z0851 *=*+1Z0852 *=*+1NUM *=*+2Z0855 *=*+1Z0856 *=*+1Z0857 *=*+1Z0858 *=*+1Z0859 *=*+1Z085A *=*+1Z085B *=*+1Z085C *=*+1Z085D *=*+1Z085E *=*+1Z085F *=*+1Z0860 *=*+1Z0861 *=*+1Z0862 *=*+1Z0863 *=*+1Z0864 *=*+1Z0865 *=*+1Z0866 *=*+1Z0867 *=*+1Z0868 *=*+1CURCHR *=*+1Z086A *=*+1Z086B *=*+1Z086C *=*+1Z086D *=*+1Z086E *=*+1Z086F *=*+1Z0870 *=*+1Z0871 *=*+1Z0872 *=*+1HRDCOP *=*+1 ; HARD COPY FLAGZ0874 *=*+1Z0875 *=*+1Z0876 *=*+1Z0877 *=*+1Z0878 *=*+1Z0879 *=*+1Z087A *=*+1Z087B *=*+1Z087C *=*+1Z087D *=*+1Z087E *=*+1Z087F *=*+1Z0880 *=*+130Z0902 *=*+2Z0903 *=*+1Z0904 *=*+1Z0905 *=*+1Z0906 *=*+1Z0907 *=*+1Z0908 *=*+1Z0909 *=*+15Z0918 *=*+1Z0919 *=*+39Z0940 *=*+2Z0942 *=*+2Z0944 *=*+2Z0946 *=*+2Z0948 *=*+1Z0949 *=*+24OBJNAM *=*+13OBJLEN *=*+1Z0975 *=*+1Z0976 *=*+1Z0977 *=*+1Z0978 *=*+1Z0979 *=*+1Z097A *=*+1Z097B *=*+1Z097C *=*+1Z097D *=*+1Z097E *=*+2Z0980 *=*+1Z0981 *=*+1Z0982 *=*+1Z0983 *=*+1Z0984 *=*+1Z0985 *=*+1Z0986 *=*+1Z0987 *=*+1Z0988 *=*+1Z0989 *=*+1Z098A *=*+3Z098D *=*+1Z098E *=*+1Z098F *=*+1;DOASM LDX #255 TXS CLD  LDA #0 STA CRSREF STX Z0974 STA Z0872 STA OUTFIL STA Z0866 STA Z087F STA Z084D STA Z084D+1 STA Z0875 STA Z0983 STA Z0984 STA Z0987 STA Z0988 STA Z085B STA Z085C LDY #>Z2DF1 LDX #<Z2DF1 STX Z0E STY Z0F LDY #0 TYA  STA (Z0E),Y LDY #$87 LDX #$FF STX Z14 STY Z15 LDY #$88 LDX #0 STX Z0976 STY Z0977 JSR Z0C2C LDA #1 STA Z084F LDA #0 STA Z0850 LDA #5 LDY #$FF LDX #0 JSR SETLFS LDA #0 JSR SETNAM JSR OPEN LDA #1 LDY #$FF LDX #3 JSR SETLFS JSR OPENZ0A0C LDA #13 JSR CHROUT LDA #>Z2340 LDY #<Z2340 JSR STRING JSR CLRCHN LDX #5 STX OUTFIL JSR CHKIN LDX #$28 STX Z05Z0A27 DEC Z05 BEQ Z0A0C JSR INPUT CMP #" " BEQ Z0A27 CMP #13 BEQ ASKHRD LDX #0 STX Z0974 STX OBJLEN BEQ FCHRSGETOBJ JSR INPUT CMP #" " BEQ OBENDFCHRS CMP #13 BEQ OBEND LDX OBJLEN CPX #18 BEQ Z0A0C STA OBJNAM,X INX  STX OBJLEN BNE GETOBJ ; ALWAYS;OBEND LDA #"," STA OBJNAM,X INX  LDA #"S" STA OBJNAM,X INX  LDA #"," STA OBJNAM,X INX  LDA #"W" STA OBJNAM,X INX  STX OBJLEN;ASKHRD LDA #>Z23A5 LDY #<Z23A5 JSR STRING JSR INPUT LDX #0 STX HRDCOP CMP #"N" BEQ DOREF; LDA #4 TAX  LDY #$FF JSR SETLFS LDA #0 JSR SETNAM JSR OPEN LDA #%10000000 STA HRDCOPDOREF LDA #>Z23BD LDY #<Z23BD JSR STRING JSR INPUT CMP #"Y" BNE NOREF STA CRSREFNOREF LDA #>Z2310 LDY #<Z2310 JSR STRING LDX #$28 STX Z05Z0ABA DEC Z05 BEQ ASKHRD JSR INPUT CMP #" " BEQ Z0ABA; CMP #13 BNE Z0ACC; JMP Z2871;Z0ACC PHA  JSR Z0B22 PLA  LDX #0 STX Z084C BEQ FRSTCGSRCN JSR INPUT CMP #" " BEQ ADDSRCFRSTC CMP #13 BEQ ADDSRC LDX Z084C CPX #$12 BEQ DOREF STA SRCNAM,X INX  STX Z084C STX SRCLEN BNE GSRCN;ADDSRC LDA #"," STA SRCNAM,X INX  LDA #"S" STA SRCNAM,X INX  STX SRCLEN LDA #>Z22DA LDY #<Z22DA JSR STRING JSR Z0B41 JSR DPLVIC LDA #>Z22D4 LDY #<Z22D4 JSR STRING JSR Z0C93 JSR Z1D21 JMP Z0CAF;Z0B22 LDA #7 LDX #8 LDY #15 JSR SETLFS LDA #"I" STA Z0908 LDA #"0" STA Z0909 LDY #>Z0908 LDX #<Z0908 LDA #2 JSR SETNAM JMP OPEN;Z0B41 LDA #2 TAY  LDX #8 JSR SETLFS LDY #>SRCNAM LDX #<SRCNAM LDA SRCLEN JSR SETNAM JSR OPEN JSR CHKST LDA #$80 STA Z087F RTS ;DPLVIC LDA HRDCOP ; DISPLAY SCREEN BPL RTS000 ; ALREADY DISPLAYED...; LDA VICHIP AND #%11111111-VID ; KILL SCREEN BLANK BIT STA VICHIPRTS000 RTS;BLKVIC LDA VICHIP ; SET VIDEO BLANK BIT ORA #VID ;...FOR EXTRA ASSEMBLEY SPEED STA VICHIP RTS ;OPNCRS JSR CLRCHN LDA CRSREF BNE OPNIT JMP Z0BF9;OPNIT LDA #8 TAX  TAY  JSR SETLFS LDY #>Z23DD LDX #<Z23DD LDA #14 JSR SETNAM JSR OPEN JSR CHKST JSR CLRCHN LDX #8 STX OUTFIL JSR CHKOUT LDA Z0E LDY Z0F STA Z16 STY Z17 LDA Z084D+1 LDY Z084D STA Z1C STY Z1D;NXCHR LDY #0;Z0BB6 LDA (Z16),Y JSR CHROUT INY  CPY #8 BNE Z0BB6; LDA Z1C ; CHECK FOR HIGH BYTE DEC BNE NDECHI ; NOT ZERO, DON'T DEC DEC Z1DNDECHI DEC Z1C ; DEC LOW BYTE NOW LDA Z1C ORA Z1D BEQ Z0BDA ; POINTER ZERO... TYA  CLC  ADC Z16 STA Z16 BCC NXCHR; INC Z17 BNE NXCHR ; ALWAYS;Z0BDA JSR CLRCHN LDA #8 JSR CLOSE LDA #9 TAY  LDX #8 JSR SETLFS LDY #>Z23EB LDX #<Z23EB LDA #14 JSR SETNAM JSR OPEN JSR CHKSTZ0BF9 JSR Z0C2C JSR Z28F2 LDA #>Z22DB LDY #<Z22DB JSR STRING LDA Z0974 BNE Z0C23 LDA OBJLEN LDY #>OBJNAM LDX #<OBJNAM JSR SETNAM LDA #6 TAY  LDX #8 JSR SETLFS JSR OPEN JSR CHKSTZ0C23 JSR Z0C93 JSR Z0B41 JMP Z0CAF;Z0C2C LDA #0 STA PC STA PC+1 STA Z0867 STA Z0868 STA Z0859 STA Z098F LDA #13 STA Z084B LDA #$DC STA Z0874 LDY #$9C LDX #0 STX Z0978 STY Z0979 STX Z0985 STY Z0986 LDA #"0" LDY #3;Z0C5C STA Z0989,Y DEY BNE Z0C5C; LDA #JUMP STA Z0989 RTS ;STRING PHA ; PRINT STRING FROM A,Y LDA #1 CMP OUTFIL ; PRINT A HARD COPY BEQ Z0C7F ; NO HARD COPY... TYA  PHA  JSR CLRCHN LDX #1 ; SET OUTPUT FOR PRINTER STX OUTFIL JSR CHKOUT PLA Z0C7E TAY Z0C7F PLA  STA Z09 STY Z08 LDY #0;Z0C86 LDA (Z08),Y INY  PHA  AND #%01111111 JSR CHROUT PLA  BPL Z0C86; RTS ;Z0C93 LDY #19 LDA #" "Z0C97 STA Z08D0,Y DEY  BPL Z0C97; LDX SRCLEN DEX  DEX  STX Z0859;Z0CA5 LDA OUTFIL,X STA Z08D0-1,X DEX  BNE Z0CA5; RTS ;Z0CAF JSR Z27D7 LDA #0 STA Z0862 STA Z0875 STA CURCHR STA Z086A STA Z0871 STA Z0877 STA Z086B STA Z086C STA Z086C+1 STA Z0861 STA Z0863 STA Z0864 STA Z0865 STA Z086E LDA Z084B BEQ Z0CE8 JSR Z0CEB BCC Z0D0FZ0CE8 JMP DOERR;Z0CEB LDX #0 INC Z0868 BNE Z0CF5 INC Z0867Z0CF5 JSR Z265F CMP #13 BEQ Z0D09 CMP #0 BNE Z0D02 SEC  RTS ;Z0D02 STA Z0880,X INX  JMP Z0CF5;Z0D09 DEX  STX Z0877 CLC  RTS ;Z0D0F JSR Z15D1 BCC Z0D25 LDX Z086E LDA Z0880,X CMP #">" BNE Z0D21 JMP Z15CB;Z0D21 CMP #";" BNE Z0D28;Z0D25 JMP Z15C4;Z0D28 JSR Z15F5 BCS Z0D36 LDA #3 LDX CURCHR TAY  JMP ERROR;Z0D36 LDX CURCHR LDA Z0880,X CMP #"." BNE NDOT JMP Z0EDD;NDOT CMP #"*" BNE NSTAR JMP Z0E1B;NSTAR LDY Z086B CPY #6 BEQ Z0D5A BCC Z0D5A LDA #9 LDY #3 JMP ERROR;Z0D5A STY Z0856 JSR Z168F BCS Z0D69 LDA #$10 LDY #3 JMP ERROR;Z0D69 LDA Z086B CMP #3 BNE Z0D78 JSR Z1B33 BCC Z0D78 JMP Z129A;Z0D78 LDX Z086E JSR LABA2Z BCS Z0D87 LDA #8 LDY #3 JMP ERROR;Z0D87 JSR Z2DCB STX Z0861 LDX #0Z0D8F LDA Z0908,X PHA  INX  CPX #6 BNE Z0D8F; LDA Z086B PHA  LDA Z086A STA Z086E INC Z086E JSR Z15D1 BCC Z0DBB LDA Z0880,X CMP #"=" BNE Z0DBB LDA Z0863 BNE Z0DF4 INC Z0863 BNE Z0E35Z0DBB JSR Z19F8 BCC Z0DEF LDA NUM CMP PC+1 BNE Z0DCE; LDA NUM+1 CMP PC BEQ Z0E0DZ0DCE LDA NUM AND NUM+1 CMP #$FF BNE Z0DE5 JSR Z2B55 BCC Z0DE0 JMP Z2B89; .END