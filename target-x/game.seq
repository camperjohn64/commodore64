 *=$0801; .WORD ZEROS .BYTE <10,>10,158," (2064)",0ZEROS .WORD 0; LDA #3 STA TARPLA+0 STA TARPLA+1 STA TARPLA+2 STA TARPLA+3; AND #0 LDX #63 ; MAKE SPRITE;CLEARS STA SPRLOC,X DEX BPL CLEARS; LDA #%00110000 STA SPRLOC STA SPRLOC+3 STA SPRLOC+9 STA SPRLOC+12 LDA #%11111100 STA SPRLOC+6 LDA #TARSPR STA SCRN+$3F8; LDA #PODSPR ; PODS... STA SCRN+$3FA STA SCRN+$3FB STA SCRN+$3FC STA SCRN+$3FD STA SCRN+$3FE STA SCRN+$3FF; SEI ; SET IRQ VECTOR LDA #<GAMELP LDY #>GAMELP STA IRQVEC STY IRQVEC+1 LDA #<NEWGAM LDY #>NEWGAM STA NMIVEC STY NMIVEC+1 LDA #$36 ; REMOVE ROMS STA 1 LDX #8 ; "CBM80" FOR RESETLOP23 LDA ENDLEV,X STA $8000,X DEX BPL LOP23; LDA #>ITIME STA IRQTIM+1 LDA #<ITIME STA IRQTIM+0; LDX #0SPRLP LDA SATSAU,X ; MOVE SATALIGHT SPRITES STA SPRLOC+$40,X LDA SATSAU+$3F,X STA SPRLOC+$7F,X DEX BNE SPRLP; LDA #1 STA PLAYMX; LDA #$C5 STA DDPRA LDA #$FE ; SET MULTICOLOUR SPRITES STA VIC+28; LDA LEVELS+4 ; SETUP FIRST SCREEN STA COL12 LDA LEVELS+5 STA COL3 JSR HRINIT; LDA LEVELS+13 STA VIC+32 LDA LEVELS+14 STA VIC+33; JSR CLEARX;;****************************;*                          *;*   SETUP START OF GAME    *;*                          *;****************************;NEWGAM SEI LDA #15 STA SOUND1+24; LDX #23 AND #0;SCLC STA SOUND1,X ; CLEAR SOUNDS DEX BPL SCLC; AND #0 STA VIC+1 STA VIC+3 STA VIC+5 STA VIC+7 STA VIC+9 STA VIC+11 STA VIC+13 STA VIC+15; LDX #<NEWGAMOKITSA STA $7FF,X DEX BNE OKITSA;NEWGM2 JSR DISTAR ; DISPLAY "TARGET-X" TITLE BCC NEWGM2; BEQ OKITSB;NEWKEY STA PLAYMX ; START GAME, # OF PLAYERS=A;OKITSB LDX #19;LOOP LDA STUP,X STA SCORES,X DEX BPL LOOP; JSR CLEARX; LDA #<LEVELS LDY #>LEVELS STA LEVEL STY LEVEL+1 STA COLEV ; SET LEVEL FOR COLOURS STY COLEV+1; AND #0 STA PLAYER ; PLAYER 1 LDA #1 STA LEVNUM ; LEVEL 1; LDA #15 STA SOUND1+24; LDX #23 AND #0;SCLC2 STA SOUND1,X ; CLEAR SOUNDS DEX BPL SCLC2;;********************;*                  *;* SETUP NEXT LEVEL *;*                  *;********************;NEWLEV SEI; LDX #$F0 ; EASY FIX FOR PLA BUG TXS ; NO TIME TO FIND BUG; LDA #80 STA TARGEX LDA #140 STA TARGEY LDA #20 ; SETUP NUMBER OF MISSILES STA MISLFT STA MISLFT+2 LDA #30 STA MISLFT+1 AND #0 ; SET BASES EXSISTANCE STA DESTRY+0 STA DESTRY+1 STA DESTRY+2 STA EXCITY; LDX PLAYER LDA CITYNM,X BNE CUNTIE JMP NOSITE;CUNTIE STA COLNUM LDA TARPLA,X STA TARSPE TXA ASL A ; *4 ASL A TAX LDA SCORES,X STA SCORE LDA SCORES+1,X STA SCORE+1 LDA SCORES+2,X STA SCORE+2 AND #$FE STA EXFLG ; FOR EXTRA CITIES... LDA SCORES+3,X STA SCORE+3 LDY #14 LDA (COLEV),Y ; SETUP LEVEL DATA STA VIC+33 DEY LDA (COLEV),Y STA VIC+32 DEY;LOOOP LDA (LEVEL),Y STA BOMNUM,Y DEY BPL LOOOP; LDY #4 ; SETUP COLOURS LDA (COLEV),Y STA COL12 INY LDA (COLEV),Y STA COL3 INY LDA (COLEV),Y STA TARCOL; JSR HRINIT ; SETUP SCREEN LDA TARSPE JSR UPSPE JSR UPSCOR JSR UPLAYR JSR UPLEV; LDA COL12 STA VIC+38 LSR A LSR A LSR A LSR A STA VIC+37 LDA COL3 STA VIC+40 STA VIC+41 STA VIC+42 STA VIC+43 STA VIC+44 STA VIC+45 STA VIC+46 STA VIC+47; LDX #5 ; CLEAR CITY AREA LDA #1;ALDED STA DESTRY+3,X DEX BPL ALDED; LDA COLNUM ; HAVE NUMBER, SET ALLDEAD CMP #7 ; >6 BCC OKCNUM ; OK CITY NUMBER; SEC SBC #6 STA EXCITY ; EXTRA CITYS... LDA #6 STA COLNUM;OKCNUM CLC ADC #3 ; BUT +3 BASES STA ALLDED;PTCTLP LDA RND ; FIND RND LOC FOR CITY EOR RND+1 SBC $D012 AND #7 CMP #6 ; NOT GOOD RND, TRY AGAIN BCS PTCTLP; TAX LDA DESTRY+3,X ; CITY ALREADY THERE? BEQ PTCTLP; AND #0 STA DESTRY+3,X DEC COLNUM BNE PTCTLP; LDX #8 ; NOW SHOW CITIES;CL LDA DESTRY,X ; DOES CITY EXIST BNE NOCTEX ; NO...; LDA SITESX,X ; SET POSITION FOR CITY SEC SBC #CITU STA X3 LDA SITESY,X SEC SBC #CITV STA Y3;CRND LDA RND+1 ; FIND TYPE OF CITY EOR RND+2 AND #3 CMP #3 BEQ CRND; STX TEMPA TAX LDA CITL,X STA OBJECT LDA CITH,X STA OBJECT+1 SEC JSR PUTOBJ ; PUT CITY ON... LDX TEMPANOCTEX DEX CPX #2 BNE CL; LDA #32 STA NXTMIS; LDA #40 STA NWCNT; LDA BOMNUM LSR A LSR A STA NUMO4 STA WAVCNT; LDA TARCOL STA VIC+39; AND #0 STA JOYBTW STA BASBTW+0 STA BASBTW+1 STA BASBTW+2 LDX #5 ; CLEAR POD SPRITE TABLE;DECKS STA SPRUSE,X DEX BPL DECKS; LDX PLAYMX ; CHECK FOR DISPLAY OF PLAYER X DEX BEQ ONLY1 JSR DISPLA;ONLY1 JSR CLEARX ; CLEAR ALL TABLES; JSR ONOD2 ; PLACE TARGET, FIXES "FLASH" ORA #$FF ; TURN SPRITES ON STA VIC+21; CLI ; START GAME...OST LDA #$7F ; CHECK CONTROL KEY STA JOY1 STA JOY2 LDA JOY1 AND #4 BNE OST5 JSR GETNUM ; CHANGE TARGET SPEED BCS OST5 STA TARSPE JSR UPSPE ; UPDATE ON SCREEN;OST5 LDA UPDATE BEQ OST6 JSR UPSCOR ; UPDATE SCORE;OST6 JSR DOEXP; LDA CUREXP BNE OST2; LDY EXCNT LDX #1WAIT DEX BNE WAIT DEY BNE WAIT; LDA #CLOSPE STA EXCNT;OST2 LDA BOMNUM ; CHECK IF LEVEL OVER ORA BOMNX ORA EXPNX ORA MISNX ORA SATALY BNE OST; LDA CUREXP CMP #$FF BNE OST; LDA #255 ; WAIT FOR 1 SECOND STA EXCNT;WAE LDA EXCNT CMP #1 BNE WAE; SEI ; STOP GAME... AND #0 ; TURN SPRITE OFF... STA VIC+21 STA SOUND3+4 ; CLEAR BEEPS/WOPS/SPURS; LDA #52 STA X3 LDA #68 STA Y3 LDX #0 ; LIST MISSILES AND POINTS;MILOOP STX TEMPA LDA DESTRY,X ; CHECK IF ANY LEFT BEQ NLEFTQ JMP NLEFT;NLEFTQ LDA MISLFT,X CMP BASEM,X BCS NROER; CLC ; REMOVE BOMB FROM SCREEN ADC ADDFB,X TAY LDA BASEMX-1,Y STA X1 LDA BASEMY-1,Y STA Y1 LDA #3 STA COLNUM JSR SETPIX JSR DOWN JSR SPIX JSR DOWN JSR SPIX JSR DOWN JSR SPIX JSR DOWN JSR SPIX;NROER LDA X3 ; PUT BOMB ON LINE CLC ADC #2 STA X3 CMP #103 ; CHECK FOR LINE DROP BCC NLDRP LDA #54 ; YES, RESET X, ADD Y STA X3 LDA Y3 ; BUMP Y CLC ADC #6 STA Y3NLDRP LDA #<BOMB STA OBJECT LDA #>BOMB STA OBJECT+1 SEC JSR PUTOBJ; SED LDA BPNTS ; ADD FOR SCORE CLC ADC SCORE STA SCORE LDA SCORE+1 ADC #0 STA SCORE+1 LDA SCORE+2 ADC #0 STA SCORE+2 LDA SCORE+3 ADC #0 STA SCORE+3 CLD JSR UPSCOR; LDA #<MSOUND ; SOUND... LDY #>MSOUND STA TEMP STY TEMP+1 LDA #2 STA V LDY #0;MSNDIT LDA (TEMP),Y ; GET BYTE FROM MEMORY LSR A ; SHIFT TO GET CORRECT NYBBLE LSR A LSR A LSR A STA SOUND1+24 LDX #8;ARNOLD DEX BNE ARNOLD; LDA (TEMP),Y ; GET SAME BYTE AND #%00001111 ; PLUCK OFF CORRECT NYBBLE STA SOUND1+24 LDX #8;FRANCO DEX BNE FRANCO; INY BNE MSNDIT; INC TEMP+1 ; INCREMENT HIGH BYTE POINTER DEC V BNE MSNDIT; LDX TEMPA DEC MISLFT,X ; REMOVE MISSILE FROM TABLE BNE MILOO2;NLEFT INX CPX #3 BEQ MILOOXMILOO2 JMP MILOOP;MILOOX LDA #44 STA X3 LDA #100 STA Y3 LDX #0 STX TEMPB;CILOOP STX TEMPA LDA DESTRY+3,X BEQ DEADCN JMP DEADC ; DEAD CITY...;DEADCN LDY #$C0 LDX #0;WA3 DEX BNE WA3 DEY BNE WA3; SED LDA BPNTS ASL A ASL A ASL A ASL A CLC ADC SCORE ; CITIES ARE WORTH 10*BOMBS STA SCORE LDA BPNTS PHP ; SAVE CARRY LSR A LSR A LSR A LSR A PLP ADC SCORE+1 STA SCORE+1 LDA SCORE+2 ADC #0 STA SCORE+2 LDA SCORE+3 ADC #0 STA SCORE+3 CLD JSR UPSCOR; INC TEMPB LDA X3 ; FIND X,Y LOCATION CLC ADC #10 STA X3 CMP #105 ; TEST FOR NEXT ROW BCC CHORND LDA #44+10 STA X3 LDA #20 CLC ADC Y3 STA Y3;CHORND LDA RND ; CHOOSE CITY FOR SCREEN EOR RND+1 AND #3 CMP #3 BEQ CHORND; TAX ; SET POINTER TO CITY LDA CITL,X STA OBJECT LDA CITH,X STA OBJECT+1 SEC JSR PUTOBJ; LDX TEMPA ; REMOVE CITY FROM BOTTOM BMI EXMOVE ; DON'T REMOVE, EXTRA... LDA SITESX+3,X SEC SBC #CITU AND #$FC STA X1 LDA SITESY+3,X SEC SBC #CITV AND #$F8 STA Y1 JSR HRADDR ; FIND ADDRESS ON SCREEN LDA BYT ; NOW FIND ACCORDING BOTTOM LOC CLC SBC #<HRLAST STA TEMP LDA BYT+1 SBC #>HRLAST STA TEMP+1 LDA TEMP CLC ADC #<BOTTOM STA TEMP LDA TEMP+1 ADC #>BOTTOM STA TEMP+1; LDX #2;RSLP LDY #23 ; NOW DO REMOVE;RLSP LDA (TEMP),Y STA (BYT),Y DEY BPL RLSP; LDA BYT ; ADD FOR NEXT LINE CLC ADC #<320 STA BYT LDA BYT+1 ADC #>320 STA BYT+1; LDA TEMP ; ADD FOR NEXT LINE CLC ADC #<320 STA TEMP LDA TEMP+1 ADC #>320 STA TEMP+1; DEX BNE RSLP;EXMOVE LDA #<CSOUND ; SOUND... LDY #>CSOUND STA TEMP STY TEMP+1 LDA #7 STA V LDY #0;CSNDIT LDA (TEMP),Y ; GET BYTE FROM MEMORY LSR A ; SHIFT TO GET CORRECT NYBBLE LSR A LSR A LSR A STA SOUND1+24 LDX #8;JOHNNY DEX BNE JOHNNY; LDA (TEMP),Y ; GET SAME BYTE AND #%00001111 ; PLUCK OFF CORRECT NYBBLE STA SOUND1+24 LDX #8;DARREL DEX BNE DARREL; INY BNE CSNDIT; INC TEMP+1 ; INCREMENT HIGH BYTE POINTER DEC V BNE CSNDIT; LDX TEMPADEADC INX CPX #6 BCS CILOO2 JMP CILOOP;CILOO2 LDA EXCITY ; CHECK FOR EXTRA CITYS BEQ CILOO3 DEC EXCITY SEC ROR TEMPA ; NEGATIVE TEMPA JMP DEADCN;CILOO3 LDA #7 ; WAIT AFTER SCORE TABULATION LDY #$80 LDX #0;WA4 DEX BNE WA4 DEY BNE WA4 SEC SBC #1 BNE WA4; LDX PLAYER ; SAVE PLAYER SHIT LDA TEMPB STA CITYNM,X BNE HEISOK JSR DISGOV PHP ; IN CASE OF LAST PLAYER PHA JSR CLEARX;HEISOK LDA TARSPE STA TARPLA,X TXA ASL A ASL A TAX LDA SCORE STA SCORES,X LDA SCORE+1 STA SCORES+1,X LDA SCORE+2 STA SCORES+2,X LDA SCORE+3 STA SCORES+3,X;NOSITE INC PLAYER LDX PLAYMXLST LDA CITYNM-1,X BNE OSDA8 DEX BNE LST; PLA ; RETURN BUTTON STATS PLP BCC DONEWG BEQ DONEWB JMP NEWKEY;DONEWB JMP OKITSB;DONEWG JMP NEWGAM ; NEW GAME...;OSDA8 PLA PLA LDA PLAYER CMP PLAYMX ; CHECK FOR NEW LEVEL BCC OKPDN AND #0 ; RESET PLAYER NUMBER STA PLAYER LDA #15 ; ADD FOR NEW DATA CLC ADC LEVEL STA LEVEL LDA LEVEL+1 ADC #0 STA LEVEL+1 CMP #>ENDLEV BNE DODLSD LDA LEVEL CMP #<ENDLEV BNE DODLSD; LDA #<STRLEV LDY #>STRLEV STA LEVEL STY LEVEL+1 LDA #<STRLEV-15 STA COLEV STY COLEV+1;DODLSD LDA #15 ; ADD FOR COLOURS CLC ADC COLEV STA COLEV LDA COLEV+1 ADC #0 STA COLEV+1 SED LDA LEVNUM ; INC LEVEL NUMBER ADC #1 STA LEVNUM CLDOKPDN JMP NEWLEV ; NEXT LEVEL...;GAMELP JSR DOBOMB JSR DOTAR JSR DOSAT JSR SOUNDE DEC EXCNT ; TIMER FOR EXPLOSIONS BEQ OID DEC EXCNT BNE EXTIRQOID INC EXCNTEXTIRQ LDA D1ICR ; CLEAR IRQ FLAGS PLA ; RESTORE REGISTERS TAY PLA TAX PLA RTI;CLEARX LDX #0 ; CLEAR TABLES FOR SIGN TXA;CLIX STA IB,X STA IB+$100,X STA IB+$200,X STA IB+$300,X STA IB+$400,X STA IB+$500,X STA IB+$600,X STA IB+$700,X DEX BNE CLIX; LDA #1 ; SET ITEMS STA MSCNT STA BMCNT STA EXCNT STA TARTIM STA SATCNT; AND #0 STA MISNX STA BOMNX STA EXPNX STA NXTBOM STA NXTEXP STA CUREXP STA MERNUM STA SATALY STA VIC+3 STA VIC+5 STA VIC+7 STA VIC+9 STA VIC+11 STA VIC+13 STA VIC+15 STA UPDATE STA NEWNMX STA MERNMX STA PODSON; RTS;CITL .BYTE <CITY1 .BYTE <CITY2 .BYTE <CITY3;CITH .BYTE >CITY1 .BYTE >CITY2 .BYTE >CITY3;STUP .BYTE 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ; SCORES .BYTE 6,6,6,6 ; CITYNM;; LEVELS AS SUCH:;; BOMNUM, SATNUM, PODNUM; BOMSPE, COL12 , COL3; TARCOL, BPNTS , SPNTS*2; YWAV  , SATTIM, NEWSAT; BORCOL, BAKCOL;LEVELS .BYTE 12,2,0 .BYTE 23,$11,$5 .BYTE $D,$5,$50,$1 .BYTE 100,190,40 .BYTE 0,0; .BYTE 16,2,0 .BYTE 18,$10,$2 .BYTE 6,$10,$00,$02 .BYTE 110,180,70 .BYTE 7,7; .BYTE 20,3,0 .BYTE 14,$11,$6 .BYTE 0,$20,$00,$03 .BYTE 100,140,50 .BYTE 13,13; .BYTE 24,4,0 .BYTE 11,$71,$D .BYTE 0,$30,$00,$05 .BYTE 100,120,20 .BYTE 2,2; .BYTE 28,3,3 .BYTE 10,$11,$0 .BYTE 2,$40,$50,$07 .BYTE 120,20,40 .BYTE 15,15; .BYTE 32,4,5 .BYTE 9,$6D,$1 .BYTE 0,$50,0,$10 .BYTE 130,30,20 .BYTE 3,3; .BYTE 36,2,0 .BYTE 23,$11,$5 .BYTE $D,$5,$50,$1 .BYTE 100,190,40 .BYTE 0,0; .BYTE 40,2,0 .BYTE 18,$10,$2 .BYTE 6,$10,$00,$02 .BYTE 110,180,70 .BYTE 7,7; .BYTE 48,3,0 .BYTE 14,$11,$6 .BYTE 0,$20,$00,$03 .BYTE 100,140,50 .BYTE 13,13; .BYTE 48,4,0 .BYTE 11,$71,$D .BYTE 0,$30,$00,$05 .BYTE 100,120,20 .BYTE 2,2; .BYTE 56,3,3 .BYTE 10,$11,$0 .BYTE 2,$40,$50,$07 .BYTE 120,20,40 .BYTE 15,15; .BYTE 56,4,5 .BYTE 9,$6D,$1 .BYTE 0,$50,0,$10 .BYTE 130,30,20 .BYTE 3,3; .BYTE 62,6,9 .BYTE 9,$1C,$6 .BYTE 7,$50,0,$20 .BYTE 100,10,10 .BYTE 0,0; .BYTE 68,8,12 .BYTE 8,$85,$1 .BYTE 6,$50,0,$20 .BYTE 160,1,1 .BYTE 3,3; .BYTE 76,8,10 .BYTE 7,$11,$6 .BYTE 7,$50,0,$20 .BYTE 140,50,20 .BYTE 14,14;; LEVEL 10;STRLEV .BYTE 80,20,14 .BYTE 6,$7C,$3 .BYTE 0,$50,0,$20 .BYTE 150,30,10 .BYTE 1,1; .BYTE 80,20,12 .BYTE 6,$91,$5 .BYTE 6,$50,0,$20 .BYTE 160,20,10 .BYTE 13,13; .BYTE 80,0,10 .BYTE 5,$1B,$7 .BYTE 13,$50,0,$20 .BYTE 140,20,1 .BYTE 0,0; .BYTE 20,1,4 .BYTE 3,$01,$9 .BYTE 2,$80,0,$80 .BYTE 70,50,255 .BYTE 7,7; .BYTE 76,20,8 .BYTE 6,$7A,$8 .BYTE 0,$80,0,$30 .BYTE 110,1,1 .BYTE 1,1; .BYTE 70,1,4 .BYTE 6,$11,$B .BYTE 7,$80,0,$30 .BYTE 120,5,13 .BYTE 0,0; .BYTE 65,1,2 .BYTE 4,$08,$A .BYTE 6,$80,0,$30 .BYTE 140,5,13 .BYTE 7,7; .BYTE 80,20,20 .BYTE 7,$0D,$5 .BYTE 15,$80,0,$30 .BYTE 180,5,13 .BYTE 1,1; .BYTE 85,20,10 .BYTE 6,$11,4 .BYTE 13,$80,0,$30 .BYTE 140,5,13 .BYTE 0,0; .BYTE 80,20,10 .BYTE 7,$1E,6 .BYTE 11,$80,0,$30 .BYTE 200,5,13 .BYTE 3,3;; LEVEL 20; .BYTE 10,0,0 .BYTE 2,$17,$E .BYTE 13,$80,0,$30 .BYTE 40,5,13 .BYTE 6,6; .BYTE 80,20,10 .BYTE 6,$0E,6 .BYTE 13,$80,0,$30 .BYTE 140,5,13 .BYTE 1,1; .BYTE 100,20,0 .BYTE 5,$11,5 .BYTE 7,$80,0,$30 .BYTE 230,5,13 .BYTE 0,0;ENDLEV .BYTE <SCREW,>SCREW .BYTE <SCREW,>SCREW .BYTE $C3,$C2,$CD,$38,$30;SCREW LDA #11 STA VIC+17 .BYTE 2; .FILE DRAW